{"ast":null,"code":"var _jsxFileName = \"/Users/omarfares/Desktop/Go/source-front/src/components/EditMovie.js\";\nimport React, { Component, Fragment } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport \"./EditMovie.css\";\nimport Input from \"./form-components/Input\";\nimport Select from \"./form-components/Select\";\nimport TextArea from \"./form-components/TextArea\";\nimport Alert from \"./ui-components/Alert\";\nimport { confirmAlert } from \"react-confirm-alert\";\nimport \"react-confirm-alert/src/react-confirm-alert.css\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default class EditMovie extends Component {\n  constructor(props) {\n    super(props);\n\n    this.handleSubmit = evt => {\n      evt.preventDefault(); // do validation\n\n      let errors = [];\n\n      if (this.state.movie.title === \"\") {\n        errors.push(\"title\");\n      }\n\n      this.setState({\n        errors: errors\n      });\n\n      if (errors.length > 0) {\n        return false;\n      } // we passed, so post info\n\n\n      const data = new FormData(evt.target);\n      const payload = Object.fromEntries(data.entries());\n      const myHeaders = new Headers();\n      myHeaders.append(\"Content-Type\", \"application/json\");\n      myHeaders.append(\"Authorization\", \"Bearer \" + this.props.jwt);\n      const requestOptions = {\n        method: \"POST\",\n        body: JSON.stringify(payload),\n        headers: myHeaders\n      };\n      fetch(\"http://localhost:4000/v1/admin/editmovie\", requestOptions).then(response => response.json()).then(data => {\n        if (data.error) {\n          this.setState({\n            alert: {\n              type: \"alert-danger\",\n              message: data.error.message\n            }\n          });\n        } else {\n          this.props.history.push({\n            pathname: \"/admin\"\n          });\n        }\n      });\n    };\n\n    this.handleChange = evt => {\n      let value = evt.target.value;\n      let name = evt.target.name;\n      this.setState(prevState => ({\n        movie: { ...prevState.movie,\n          [name]: value\n        }\n      }));\n    };\n\n    this.confirmDelete = e => {\n      console.log(\"would delete id\", this.state.movie.id);\n      confirmAlert({\n        title: \"Delete Movie?\",\n        message: \"Are you sure?\",\n        buttons: [{\n          label: \"Yes\",\n          onClick: () => {\n            // delete the movie\n            const myHeaders = new Headers();\n            myHeaders.append(\"Content-Type\", \"application/json\");\n            myHeaders.append(\"Authorization\", \"Bearer \" + this.props.jwt);\n            fetch(\"http://localhost:4000/v1/admin/deletemovie/\" + this.state.movie.id, {\n              method: \"GET\",\n              headers: myHeaders\n            }).then(response => response.json).then(data => {\n              if (data.error) {\n                this.setState({\n                  alert: {\n                    type: \"alert-danger\",\n                    message: data.error.message\n                  }\n                });\n              } else {\n                this.setState({\n                  alert: {\n                    type: \"alert-success\",\n                    message: \"Movie deleted!\"\n                  }\n                });\n                this.props.history.push({\n                  pathname: \"/admin\"\n                });\n              }\n            });\n          }\n        }, {\n          label: \"No\",\n          onClick: () => {}\n        }]\n      });\n    };\n\n    this.state = {\n      movie: {\n        id: 0,\n        title: \"\",\n        release_date: \"\",\n        runtime: \"\",\n        mpaa_rating: \"\",\n        rating: \"\",\n        description: \"\"\n      },\n      mpaaOptions: [{\n        id: \"G\",\n        value: \"G\"\n      }, {\n        id: \"PG\",\n        value: \"PG\"\n      }, {\n        id: \"PG13\",\n        value: \"PG13\"\n      }, {\n        id: \"R\",\n        value: \"R\"\n      }, {\n        id: \"NC17\",\n        value: \"NC17\"\n      }],\n      isLoaded: false,\n      error: null,\n      errors: [],\n      alert: {\n        type: \"d-none\",\n        message: \"\"\n      }\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.props.jwt === \"\") {\n      this.props.history.push({\n        pathname: \"/login\"\n      });\n      return;\n    }\n\n    const id = this.props.match.params.id;\n\n    if (id > 0) {\n      fetch(\"http://localhost:4000/v1/movie/\" + id).then(response => {\n        if (response.status !== \"200\") {\n          let err = Error;\n          err.message = \"Invalid response code: \" + response.status;\n          this.setState({\n            error: err\n          });\n        }\n\n        return response.json();\n      }).then(json => {\n        const releaseDate = new Date(json.movie.release_date);\n        this.setState({\n          movie: {\n            id: id,\n            title: json.movie.title,\n            release_date: releaseDate.toISOString().split(\"T\")[0],\n            runtime: json.movie.runtime,\n            mpaa_rating: json.movie.mpaa_rating,\n            rating: json.movie.rating,\n            description: json.movie.description\n          },\n          isLoaded: true\n        }, error => {\n          this.setState({\n            isLoaded: true,\n            error\n          });\n        });\n      });\n    } else {\n      this.setState({\n        isLoaded: true\n      });\n    }\n  }\n\n  // *** add this\n  hasError(key) {\n    return this.state.errors.indexOf(key) !== -1;\n  }\n\n  render() {\n    let {\n      movie,\n      isLoaded,\n      error\n    } = this.state;\n\n    if (error) {\n      return /*#__PURE__*/_jsxDEV(\"div\", {\n        children: [\"Error: \", error.message]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 202,\n        columnNumber: 14\n      }, this);\n    } else if (!isLoaded) {\n      return /*#__PURE__*/_jsxDEV(\"p\", {\n        children: \"Loading...\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 204,\n        columnNumber: 14\n      }, this);\n    } else {\n      return /*#__PURE__*/_jsxDEV(Fragment, {\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          children: \"Add/Edit Movie\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 208,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(Alert, {\n          alertType: this.state.alert.type,\n          alertMessage: this.state.alert.message\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 209,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 213,\n          columnNumber: 11\n        }, this), /*#__PURE__*/_jsxDEV(\"form\", {\n          onSubmit: this.handleSubmit,\n          children: [/*#__PURE__*/_jsxDEV(\"input\", {\n            type: \"hidden\",\n            name: \"id\",\n            id: \"id\",\n            value: movie.id,\n            onChange: this.handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 215,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            title: \"Title\",\n            className: this.hasError(\"title\") ? \"is-invalid\" : \"\",\n            type: \"text\",\n            name: \"title\",\n            value: movie.title,\n            handleChange: this.handleChange,\n            errorDiv: this.hasError(\"title\") ? \"text-danger\" : \"d-none\",\n            errorMsg: \"Please enter a title\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 223,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            title: \"Release Date\",\n            type: \"date\",\n            name: \"release_date\",\n            value: movie.release_date,\n            handleChange: this.handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 234,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            title: \"Runtime\",\n            type: \"text\",\n            name: \"runtime\",\n            value: movie.runtime,\n            handleChange: this.handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 242,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Select, {\n            title: \"MPAA Rating\",\n            name: \"mpaa_rating\",\n            options: this.state.mpaaOptions,\n            value: movie.mpaa_rating,\n            handleChange: this.handleChange,\n            placeholder: \"Choose...\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 250,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Input, {\n            title: \"Rating\",\n            type: \"text\",\n            name: \"rating\",\n            value: movie.rating,\n            handleChange: this.handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 259,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(TextArea, {\n            title: \"Description\",\n            name: \"description\",\n            value: movie.description,\n            rows: \"3\",\n            handleChange: this.handleChange\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 267,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"hr\", {}, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 275,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            className: \"btn btn-primary\",\n            children: \"Save\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 277,\n            columnNumber: 13\n          }, this), /*#__PURE__*/_jsxDEV(Link, {\n            to: \"/admin\",\n            className: \"btn btn-warning ms-1\",\n            children: \"Cancel\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 278,\n            columnNumber: 13\n          }, this), movie.id > 0 && /*#__PURE__*/_jsxDEV(\"a\", {\n            href: \"#!\",\n            onClick: () => this.confirmDelete(),\n            className: \"btn btn-danger ms-1\",\n            children: \"Delete\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 282,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 214,\n          columnNumber: 11\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 207,\n        columnNumber: 9\n      }, this);\n    }\n  }\n\n}","map":{"version":3,"sources":["/Users/omarfares/Desktop/Go/source-front/src/components/EditMovie.js"],"names":["React","Component","Fragment","Link","Input","Select","TextArea","Alert","confirmAlert","EditMovie","constructor","props","handleSubmit","evt","preventDefault","errors","state","movie","title","push","setState","length","data","FormData","target","payload","Object","fromEntries","entries","myHeaders","Headers","append","jwt","requestOptions","method","body","JSON","stringify","headers","fetch","then","response","json","error","alert","type","message","history","pathname","handleChange","value","name","prevState","confirmDelete","e","console","log","id","buttons","label","onClick","release_date","runtime","mpaa_rating","rating","description","mpaaOptions","isLoaded","bind","componentDidMount","match","params","status","err","Error","releaseDate","Date","toISOString","split","hasError","key","indexOf","render"],"mappings":";AAAA,OAAOA,KAAP,IAAgBC,SAAhB,EAA2BC,QAA3B,QAA2C,OAA3C;AACA,SAASC,IAAT,QAAqB,kBAArB;AACA,OAAO,iBAAP;AACA,OAAOC,KAAP,MAAkB,yBAAlB;AACA,OAAOC,MAAP,MAAmB,0BAAnB;AACA,OAAOC,QAAP,MAAqB,4BAArB;AACA,OAAOC,KAAP,MAAkB,uBAAlB;AACA,SAASC,YAAT,QAA6B,qBAA7B;AACA,OAAO,iDAAP;;AAEA,eAAe,MAAMC,SAAN,SAAwBR,SAAxB,CAAkC;AAC/CS,EAAAA,WAAW,CAACC,KAAD,EAAQ;AACjB,UAAMA,KAAN;;AADiB,SA+EnBC,YA/EmB,GA+EHC,GAAD,IAAS;AACtBA,MAAAA,GAAG,CAACC,cAAJ,GADsB,CAEtB;;AACA,UAAIC,MAAM,GAAG,EAAb;;AACA,UAAI,KAAKC,KAAL,CAAWC,KAAX,CAAiBC,KAAjB,KAA2B,EAA/B,EAAmC;AACjCH,QAAAA,MAAM,CAACI,IAAP,CAAY,OAAZ;AACD;;AAED,WAAKC,QAAL,CAAc;AAAEL,QAAAA,MAAM,EAAEA;AAAV,OAAd;;AAEA,UAAIA,MAAM,CAACM,MAAP,GAAgB,CAApB,EAAuB;AACrB,eAAO,KAAP;AACD,OAZqB,CActB;;;AACA,YAAMC,IAAI,GAAG,IAAIC,QAAJ,CAAaV,GAAG,CAACW,MAAjB,CAAb;AACA,YAAMC,OAAO,GAAGC,MAAM,CAACC,WAAP,CAAmBL,IAAI,CAACM,OAAL,EAAnB,CAAhB;AACA,YAAMC,SAAS,GAAG,IAAIC,OAAJ,EAAlB;AACAD,MAAAA,SAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AACAF,MAAAA,SAAS,CAACE,MAAV,CAAiB,eAAjB,EAAkC,YAAY,KAAKpB,KAAL,CAAWqB,GAAzD;AAEA,YAAMC,cAAc,GAAG;AACrBC,QAAAA,MAAM,EAAE,MADa;AAErBC,QAAAA,IAAI,EAAEC,IAAI,CAACC,SAAL,CAAeZ,OAAf,CAFe;AAGrBa,QAAAA,OAAO,EAAET;AAHY,OAAvB;AAKAU,MAAAA,KAAK,CAAC,0CAAD,EAA6CN,cAA7C,CAAL,CACGO,IADH,CACSC,QAAD,IAAcA,QAAQ,CAACC,IAAT,EADtB,EAEGF,IAFH,CAESlB,IAAD,IAAU;AACd,YAAIA,IAAI,CAACqB,KAAT,EAAgB;AACd,eAAKvB,QAAL,CAAc;AACZwB,YAAAA,KAAK,EAAE;AAAEC,cAAAA,IAAI,EAAE,cAAR;AAAwBC,cAAAA,OAAO,EAAExB,IAAI,CAACqB,KAAL,CAAWG;AAA5C;AADK,WAAd;AAGD,SAJD,MAIO;AACL,eAAKnC,KAAL,CAAWoC,OAAX,CAAmB5B,IAAnB,CAAwB;AACtB6B,YAAAA,QAAQ,EAAE;AADY,WAAxB;AAGD;AACF,OAZH;AAaD,KAtHkB;;AAAA,SAwHnBC,YAxHmB,GAwHHpC,GAAD,IAAS;AACtB,UAAIqC,KAAK,GAAGrC,GAAG,CAACW,MAAJ,CAAW0B,KAAvB;AACA,UAAIC,IAAI,GAAGtC,GAAG,CAACW,MAAJ,CAAW2B,IAAtB;AACA,WAAK/B,QAAL,CAAegC,SAAD,KAAgB;AAC5BnC,QAAAA,KAAK,EAAE,EACL,GAAGmC,SAAS,CAACnC,KADR;AAEL,WAACkC,IAAD,GAAQD;AAFH;AADqB,OAAhB,CAAd;AAMD,KAjIkB;;AAAA,SAwInBG,aAxImB,GAwIFC,CAAD,IAAO;AACrBC,MAAAA,OAAO,CAACC,GAAR,CAAY,iBAAZ,EAA+B,KAAKxC,KAAL,CAAWC,KAAX,CAAiBwC,EAAhD;AAEAjD,MAAAA,YAAY,CAAC;AACXU,QAAAA,KAAK,EAAE,eADI;AAEX4B,QAAAA,OAAO,EAAE,eAFE;AAGXY,QAAAA,OAAO,EAAE,CACP;AACEC,UAAAA,KAAK,EAAE,KADT;AAEEC,UAAAA,OAAO,EAAE,MAAM;AACb;AACA,kBAAM/B,SAAS,GAAG,IAAIC,OAAJ,EAAlB;AACAD,YAAAA,SAAS,CAACE,MAAV,CAAiB,cAAjB,EAAiC,kBAAjC;AACAF,YAAAA,SAAS,CAACE,MAAV,CAAiB,eAAjB,EAAkC,YAAY,KAAKpB,KAAL,CAAWqB,GAAzD;AAEAO,YAAAA,KAAK,CACH,gDACE,KAAKvB,KAAL,CAAWC,KAAX,CAAiBwC,EAFhB,EAGH;AACEvB,cAAAA,MAAM,EAAE,KADV;AAEEI,cAAAA,OAAO,EAAET;AAFX,aAHG,CAAL,CAQGW,IARH,CAQSC,QAAD,IAAcA,QAAQ,CAACC,IAR/B,EASGF,IATH,CASSlB,IAAD,IAAU;AACd,kBAAIA,IAAI,CAACqB,KAAT,EAAgB;AACd,qBAAKvB,QAAL,CAAc;AACZwB,kBAAAA,KAAK,EAAE;AACLC,oBAAAA,IAAI,EAAE,cADD;AAELC,oBAAAA,OAAO,EAAExB,IAAI,CAACqB,KAAL,CAAWG;AAFf;AADK,iBAAd;AAMD,eAPD,MAOO;AACL,qBAAK1B,QAAL,CAAc;AACZwB,kBAAAA,KAAK,EAAE;AAAEC,oBAAAA,IAAI,EAAE,eAAR;AAAyBC,oBAAAA,OAAO,EAAE;AAAlC;AADK,iBAAd;AAGA,qBAAKnC,KAAL,CAAWoC,OAAX,CAAmB5B,IAAnB,CAAwB;AACtB6B,kBAAAA,QAAQ,EAAE;AADY,iBAAxB;AAGD;AACF,aAzBH;AA0BD;AAlCH,SADO,EAqCP;AACEW,UAAAA,KAAK,EAAE,IADT;AAEEC,UAAAA,OAAO,EAAE,MAAM,CAAE;AAFnB,SArCO;AAHE,OAAD,CAAZ;AA8CD,KAzLkB;;AAEjB,SAAK5C,KAAL,GAAa;AACXC,MAAAA,KAAK,EAAE;AACLwC,QAAAA,EAAE,EAAE,CADC;AAELvC,QAAAA,KAAK,EAAE,EAFF;AAGL2C,QAAAA,YAAY,EAAE,EAHT;AAILC,QAAAA,OAAO,EAAE,EAJJ;AAKLC,QAAAA,WAAW,EAAE,EALR;AAMLC,QAAAA,MAAM,EAAE,EANH;AAOLC,QAAAA,WAAW,EAAE;AAPR,OADI;AAUXC,MAAAA,WAAW,EAAE,CACX;AAAET,QAAAA,EAAE,EAAE,GAAN;AAAWP,QAAAA,KAAK,EAAE;AAAlB,OADW,EAEX;AAAEO,QAAAA,EAAE,EAAE,IAAN;AAAYP,QAAAA,KAAK,EAAE;AAAnB,OAFW,EAGX;AAAEO,QAAAA,EAAE,EAAE,MAAN;AAAcP,QAAAA,KAAK,EAAE;AAArB,OAHW,EAIX;AAAEO,QAAAA,EAAE,EAAE,GAAN;AAAWP,QAAAA,KAAK,EAAE;AAAlB,OAJW,EAKX;AAAEO,QAAAA,EAAE,EAAE,MAAN;AAAcP,QAAAA,KAAK,EAAE;AAArB,OALW,CAVF;AAiBXiB,MAAAA,QAAQ,EAAE,KAjBC;AAkBXxB,MAAAA,KAAK,EAAE,IAlBI;AAmBX5B,MAAAA,MAAM,EAAE,EAnBG;AAoBX6B,MAAAA,KAAK,EAAE;AACLC,QAAAA,IAAI,EAAE,QADD;AAELC,QAAAA,OAAO,EAAE;AAFJ;AApBI,KAAb;AAyBA,SAAKG,YAAL,GAAoB,KAAKA,YAAL,CAAkBmB,IAAlB,CAAuB,IAAvB,CAApB;AACA,SAAKxD,YAAL,GAAoB,KAAKA,YAAL,CAAkBwD,IAAlB,CAAuB,IAAvB,CAApB;AACD;;AAEDC,EAAAA,iBAAiB,GAAG;AAClB,QAAI,KAAK1D,KAAL,CAAWqB,GAAX,KAAmB,EAAvB,EAA2B;AACzB,WAAKrB,KAAL,CAAWoC,OAAX,CAAmB5B,IAAnB,CAAwB;AACtB6B,QAAAA,QAAQ,EAAE;AADY,OAAxB;AAGA;AACD;;AAED,UAAMS,EAAE,GAAG,KAAK9C,KAAL,CAAW2D,KAAX,CAAiBC,MAAjB,CAAwBd,EAAnC;;AACA,QAAIA,EAAE,GAAG,CAAT,EAAY;AACVlB,MAAAA,KAAK,CAAC,oCAAoCkB,EAArC,CAAL,CACGjB,IADH,CACSC,QAAD,IAAc;AAClB,YAAIA,QAAQ,CAAC+B,MAAT,KAAoB,KAAxB,EAA+B;AAC7B,cAAIC,GAAG,GAAGC,KAAV;AACAD,UAAAA,GAAG,CAAC3B,OAAJ,GAAc,4BAA4BL,QAAQ,CAAC+B,MAAnD;AACA,eAAKpD,QAAL,CAAc;AAAEuB,YAAAA,KAAK,EAAE8B;AAAT,WAAd;AACD;;AACD,eAAOhC,QAAQ,CAACC,IAAT,EAAP;AACD,OARH,EASGF,IATH,CASSE,IAAD,IAAU;AACd,cAAMiC,WAAW,GAAG,IAAIC,IAAJ,CAASlC,IAAI,CAACzB,KAAL,CAAW4C,YAApB,CAApB;AAEA,aAAKzC,QAAL,CACE;AACEH,UAAAA,KAAK,EAAE;AACLwC,YAAAA,EAAE,EAAEA,EADC;AAELvC,YAAAA,KAAK,EAAEwB,IAAI,CAACzB,KAAL,CAAWC,KAFb;AAGL2C,YAAAA,YAAY,EAAEc,WAAW,CAACE,WAAZ,GAA0BC,KAA1B,CAAgC,GAAhC,EAAqC,CAArC,CAHT;AAILhB,YAAAA,OAAO,EAAEpB,IAAI,CAACzB,KAAL,CAAW6C,OAJf;AAKLC,YAAAA,WAAW,EAAErB,IAAI,CAACzB,KAAL,CAAW8C,WALnB;AAMLC,YAAAA,MAAM,EAAEtB,IAAI,CAACzB,KAAL,CAAW+C,MANd;AAOLC,YAAAA,WAAW,EAAEvB,IAAI,CAACzB,KAAL,CAAWgD;AAPnB,WADT;AAUEE,UAAAA,QAAQ,EAAE;AAVZ,SADF,EAaGxB,KAAD,IAAW;AACT,eAAKvB,QAAL,CAAc;AACZ+C,YAAAA,QAAQ,EAAE,IADE;AAEZxB,YAAAA;AAFY,WAAd;AAID,SAlBH;AAoBD,OAhCH;AAiCD,KAlCD,MAkCO;AACL,WAAKvB,QAAL,CAAc;AAAE+C,QAAAA,QAAQ,EAAE;AAAZ,OAAd;AACD;AACF;;AAsDD;AACAY,EAAAA,QAAQ,CAACC,GAAD,EAAM;AACZ,WAAO,KAAKhE,KAAL,CAAWD,MAAX,CAAkBkE,OAAlB,CAA0BD,GAA1B,MAAmC,CAAC,CAA3C;AACD;;AAqDDE,EAAAA,MAAM,GAAG;AACP,QAAI;AAAEjE,MAAAA,KAAF;AAASkD,MAAAA,QAAT;AAAmBxB,MAAAA;AAAnB,QAA6B,KAAK3B,KAAtC;;AACA,QAAI2B,KAAJ,EAAW;AACT,0BAAO;AAAA,8BAAaA,KAAK,CAACG,OAAnB;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;AACD,KAFD,MAEO,IAAI,CAACqB,QAAL,EAAe;AACpB,0BAAO;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,cAAP;AACD,KAFM,MAEA;AACL,0BACE,QAAC,QAAD;AAAA,gCACE;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,gBADF,eAEE,QAAC,KAAD;AACE,UAAA,SAAS,EAAE,KAAKnD,KAAL,CAAW4B,KAAX,CAAiBC,IAD9B;AAEE,UAAA,YAAY,EAAE,KAAK7B,KAAL,CAAW4B,KAAX,CAAiBE;AAFjC;AAAA;AAAA;AAAA;AAAA,gBAFF,eAME;AAAA;AAAA;AAAA;AAAA,gBANF,eAOE;AAAM,UAAA,QAAQ,EAAE,KAAKlC,YAArB;AAAA,kCACE;AACE,YAAA,IAAI,EAAC,QADP;AAEE,YAAA,IAAI,EAAC,IAFP;AAGE,YAAA,EAAE,EAAC,IAHL;AAIE,YAAA,KAAK,EAAEK,KAAK,CAACwC,EAJf;AAKE,YAAA,QAAQ,EAAE,KAAKR;AALjB;AAAA;AAAA;AAAA;AAAA,kBADF,eASE,QAAC,KAAD;AACE,YAAA,KAAK,EAAE,OADT;AAEE,YAAA,SAAS,EAAE,KAAK8B,QAAL,CAAc,OAAd,IAAyB,YAAzB,GAAwC,EAFrD;AAGE,YAAA,IAAI,EAAE,MAHR;AAIE,YAAA,IAAI,EAAE,OAJR;AAKE,YAAA,KAAK,EAAE9D,KAAK,CAACC,KALf;AAME,YAAA,YAAY,EAAE,KAAK+B,YANrB;AAOE,YAAA,QAAQ,EAAE,KAAK8B,QAAL,CAAc,OAAd,IAAyB,aAAzB,GAAyC,QAPrD;AAQE,YAAA,QAAQ,EAAE;AARZ;AAAA;AAAA;AAAA;AAAA,kBATF,eAoBE,QAAC,KAAD;AACE,YAAA,KAAK,EAAE,cADT;AAEE,YAAA,IAAI,EAAE,MAFR;AAGE,YAAA,IAAI,EAAE,cAHR;AAIE,YAAA,KAAK,EAAE9D,KAAK,CAAC4C,YAJf;AAKE,YAAA,YAAY,EAAE,KAAKZ;AALrB;AAAA;AAAA;AAAA;AAAA,kBApBF,eA4BE,QAAC,KAAD;AACE,YAAA,KAAK,EAAE,SADT;AAEE,YAAA,IAAI,EAAE,MAFR;AAGE,YAAA,IAAI,EAAE,SAHR;AAIE,YAAA,KAAK,EAAEhC,KAAK,CAAC6C,OAJf;AAKE,YAAA,YAAY,EAAE,KAAKb;AALrB;AAAA;AAAA;AAAA;AAAA,kBA5BF,eAoCE,QAAC,MAAD;AACE,YAAA,KAAK,EAAE,aADT;AAEE,YAAA,IAAI,EAAE,aAFR;AAGE,YAAA,OAAO,EAAE,KAAKjC,KAAL,CAAWkD,WAHtB;AAIE,YAAA,KAAK,EAAEjD,KAAK,CAAC8C,WAJf;AAKE,YAAA,YAAY,EAAE,KAAKd,YALrB;AAME,YAAA,WAAW,EAAC;AANd;AAAA;AAAA;AAAA;AAAA,kBApCF,eA6CE,QAAC,KAAD;AACE,YAAA,KAAK,EAAE,QADT;AAEE,YAAA,IAAI,EAAE,MAFR;AAGE,YAAA,IAAI,EAAE,QAHR;AAIE,YAAA,KAAK,EAAEhC,KAAK,CAAC+C,MAJf;AAKE,YAAA,YAAY,EAAE,KAAKf;AALrB;AAAA;AAAA;AAAA;AAAA,kBA7CF,eAqDE,QAAC,QAAD;AACE,YAAA,KAAK,EAAE,aADT;AAEE,YAAA,IAAI,EAAE,aAFR;AAGE,YAAA,KAAK,EAAEhC,KAAK,CAACgD,WAHf;AAIE,YAAA,IAAI,EAAE,GAJR;AAKE,YAAA,YAAY,EAAE,KAAKhB;AALrB;AAAA;AAAA;AAAA;AAAA,kBArDF,eA6DE;AAAA;AAAA;AAAA;AAAA,kBA7DF,eA+DE;AAAQ,YAAA,SAAS,EAAC,iBAAlB;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBA/DF,eAgEE,QAAC,IAAD;AAAM,YAAA,EAAE,EAAC,QAAT;AAAkB,YAAA,SAAS,EAAC,sBAA5B;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBAhEF,EAmEGhC,KAAK,CAACwC,EAAN,GAAW,CAAX,iBACC;AACE,YAAA,IAAI,EAAC,IADP;AAEE,YAAA,OAAO,EAAE,MAAM,KAAKJ,aAAL,EAFjB;AAGE,YAAA,SAAS,EAAC,qBAHZ;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA,kBApEJ;AAAA;AAAA;AAAA;AAAA;AAAA,gBAPF;AAAA;AAAA;AAAA;AAAA;AAAA,cADF;AAuFD;AACF;;AA3R8C","sourcesContent":["import React, { Component, Fragment } from \"react\";\nimport { Link } from \"react-router-dom\";\nimport \"./EditMovie.css\";\nimport Input from \"./form-components/Input\";\nimport Select from \"./form-components/Select\";\nimport TextArea from \"./form-components/TextArea\";\nimport Alert from \"./ui-components/Alert\";\nimport { confirmAlert } from \"react-confirm-alert\";\nimport \"react-confirm-alert/src/react-confirm-alert.css\";\n\nexport default class EditMovie extends Component {\n  constructor(props) {\n    super(props);\n    this.state = {\n      movie: {\n        id: 0,\n        title: \"\",\n        release_date: \"\",\n        runtime: \"\",\n        mpaa_rating: \"\",\n        rating: \"\",\n        description: \"\",\n      },\n      mpaaOptions: [\n        { id: \"G\", value: \"G\" },\n        { id: \"PG\", value: \"PG\" },\n        { id: \"PG13\", value: \"PG13\" },\n        { id: \"R\", value: \"R\" },\n        { id: \"NC17\", value: \"NC17\" },\n      ],\n      isLoaded: false,\n      error: null,\n      errors: [],\n      alert: {\n        type: \"d-none\",\n        message: \"\",\n      },\n    };\n    this.handleChange = this.handleChange.bind(this);\n    this.handleSubmit = this.handleSubmit.bind(this);\n  }\n\n  componentDidMount() {\n    if (this.props.jwt === \"\") {\n      this.props.history.push({\n        pathname: \"/login\",\n      });\n      return;\n    }\n\n    const id = this.props.match.params.id;\n    if (id > 0) {\n      fetch(\"http://localhost:4000/v1/movie/\" + id)\n        .then((response) => {\n          if (response.status !== \"200\") {\n            let err = Error;\n            err.message = \"Invalid response code: \" + response.status;\n            this.setState({ error: err });\n          }\n          return response.json();\n        })\n        .then((json) => {\n          const releaseDate = new Date(json.movie.release_date);\n\n          this.setState(\n            {\n              movie: {\n                id: id,\n                title: json.movie.title,\n                release_date: releaseDate.toISOString().split(\"T\")[0],\n                runtime: json.movie.runtime,\n                mpaa_rating: json.movie.mpaa_rating,\n                rating: json.movie.rating,\n                description: json.movie.description,\n              },\n              isLoaded: true,\n            },\n            (error) => {\n              this.setState({\n                isLoaded: true,\n                error,\n              });\n            }\n          );\n        });\n    } else {\n      this.setState({ isLoaded: true });\n    }\n  }\n\n  handleSubmit = (evt) => {\n    evt.preventDefault();\n    // do validation\n    let errors = [];\n    if (this.state.movie.title === \"\") {\n      errors.push(\"title\");\n    }\n\n    this.setState({ errors: errors });\n\n    if (errors.length > 0) {\n      return false;\n    }\n\n    // we passed, so post info\n    const data = new FormData(evt.target);\n    const payload = Object.fromEntries(data.entries());\n    const myHeaders = new Headers();\n    myHeaders.append(\"Content-Type\", \"application/json\");\n    myHeaders.append(\"Authorization\", \"Bearer \" + this.props.jwt);\n\n    const requestOptions = {\n      method: \"POST\",\n      body: JSON.stringify(payload),\n      headers: myHeaders,\n    };\n    fetch(\"http://localhost:4000/v1/admin/editmovie\", requestOptions)\n      .then((response) => response.json())\n      .then((data) => {\n        if (data.error) {\n          this.setState({\n            alert: { type: \"alert-danger\", message: data.error.message },\n          });\n        } else {\n          this.props.history.push({\n            pathname: \"/admin\",\n          });\n        }\n      });\n  };\n\n  handleChange = (evt) => {\n    let value = evt.target.value;\n    let name = evt.target.name;\n    this.setState((prevState) => ({\n      movie: {\n        ...prevState.movie,\n        [name]: value,\n      },\n    }));\n  };\n\n  // *** add this\n  hasError(key) {\n    return this.state.errors.indexOf(key) !== -1;\n  }\n\n  confirmDelete = (e) => {\n    console.log(\"would delete id\", this.state.movie.id);\n\n    confirmAlert({\n      title: \"Delete Movie?\",\n      message: \"Are you sure?\",\n      buttons: [\n        {\n          label: \"Yes\",\n          onClick: () => {\n            // delete the movie\n            const myHeaders = new Headers();\n            myHeaders.append(\"Content-Type\", \"application/json\");\n            myHeaders.append(\"Authorization\", \"Bearer \" + this.props.jwt);\n\n            fetch(\n              \"http://localhost:4000/v1/admin/deletemovie/\" +\n                this.state.movie.id,\n              {\n                method: \"GET\",\n                headers: myHeaders,\n              }\n            )\n              .then((response) => response.json)\n              .then((data) => {\n                if (data.error) {\n                  this.setState({\n                    alert: {\n                      type: \"alert-danger\",\n                      message: data.error.message,\n                    },\n                  });\n                } else {\n                  this.setState({\n                    alert: { type: \"alert-success\", message: \"Movie deleted!\" },\n                  });\n                  this.props.history.push({\n                    pathname: \"/admin\",\n                  });\n                }\n              });\n          },\n        },\n        {\n          label: \"No\",\n          onClick: () => {},\n        },\n      ],\n    });\n  };\n\n  render() {\n    let { movie, isLoaded, error } = this.state;\n    if (error) {\n      return <div>Error: {error.message}</div>;\n    } else if (!isLoaded) {\n      return <p>Loading...</p>;\n    } else {\n      return (\n        <Fragment>\n          <h2>Add/Edit Movie</h2>\n          <Alert\n            alertType={this.state.alert.type}\n            alertMessage={this.state.alert.message}\n          />\n          <hr />\n          <form onSubmit={this.handleSubmit}>\n            <input\n              type=\"hidden\"\n              name=\"id\"\n              id=\"id\"\n              value={movie.id}\n              onChange={this.handleChange}\n            />\n\n            <Input\n              title={\"Title\"}\n              className={this.hasError(\"title\") ? \"is-invalid\" : \"\"}\n              type={\"text\"}\n              name={\"title\"}\n              value={movie.title}\n              handleChange={this.handleChange}\n              errorDiv={this.hasError(\"title\") ? \"text-danger\" : \"d-none\"}\n              errorMsg={\"Please enter a title\"}\n            />\n\n            <Input\n              title={\"Release Date\"}\n              type={\"date\"}\n              name={\"release_date\"}\n              value={movie.release_date}\n              handleChange={this.handleChange}\n            />\n\n            <Input\n              title={\"Runtime\"}\n              type={\"text\"}\n              name={\"runtime\"}\n              value={movie.runtime}\n              handleChange={this.handleChange}\n            />\n\n            <Select\n              title={\"MPAA Rating\"}\n              name={\"mpaa_rating\"}\n              options={this.state.mpaaOptions}\n              value={movie.mpaa_rating}\n              handleChange={this.handleChange}\n              placeholder=\"Choose...\"\n            />\n\n            <Input\n              title={\"Rating\"}\n              type={\"text\"}\n              name={\"rating\"}\n              value={movie.rating}\n              handleChange={this.handleChange}\n            />\n\n            <TextArea\n              title={\"Description\"}\n              name={\"description\"}\n              value={movie.description}\n              rows={\"3\"}\n              handleChange={this.handleChange}\n            />\n\n            <hr />\n\n            <button className=\"btn btn-primary\">Save</button>\n            <Link to=\"/admin\" className=\"btn btn-warning ms-1\">\n              Cancel\n            </Link>\n            {movie.id > 0 && (\n              <a\n                href=\"#!\"\n                onClick={() => this.confirmDelete()}\n                className=\"btn btn-danger ms-1\"\n              >\n                Delete\n              </a>\n            )}\n          </form>\n        </Fragment>\n      );\n    }\n  }\n}\n"]},"metadata":{},"sourceType":"module"}